{% extends "admin/admin_base.html" %}
{% block title %}Product Detail — Admin{% endblock %}

{% block content %}
<div class="flex flex-col gap-6">

  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex flex-row justify-between">
      <div>
        <p class="text-sm uppercase tracking-[0.2em] text-purple-300/80">Product</p>
        <h1 id="productName" class="text-3xl font-bold mt-1">Loading...</h1>
        <p id="productCategory" class="text-gray-400 text-sm mt-1"></p>
      </div>
      <button onclick="window.location.href='/admin/products'"
        class="ml-4 my-6 px-4 h-auto w-auto bg-white/5 hover:bg-white/10 rounded-lg border border-white/10">
        ← Back
      </button>
    </div>

    <div class="flex flex-col sm:flex-row gap-2">

      <button id="saveBtn"
        class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg font-semibold">
        Save Changes
      </button>
    </div>
  </div>

  <!-- Product Info Section-->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Product Preview -->
    <div class="bg-black/50 border border-white/10 rounded-2xl p-6 flex flex-col gap-4">
      <div>
        <p class="text-lg font-semibold text-white mt-1" id="previewName"></p>
        <p class="text-sm text-gray-400">Preview</p>
      </div>
      <img id="productImage" src=""
        class="w-full aspect-[4/5] object-cover rounded-xl border border-white/10" />

      <p class="text-purple-300 font-bold" id="previewPrice"></p>
    </div>

    <!-- Product Details -->
    <div class="lg:col-span-2 bg-black/50 border border-white/10 rounded-2xl p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="space-y-3">
          <label class="text-sm text-gray-300">Name</label>
          <input id="fName"
            class="w-full p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
        </div>
        <div class="space-y-3">
          <label class="text-sm text-gray-300">Category</label>
          <input id="fCategory"
            class="w-full p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
        </div>
        <div class="space-y-3">
          <label class="text-sm text-gray-300">Price (₹)</label>
          <input id="fPrice" type="number" step="0.01" min="0"
            class="w-full p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
        </div>
        <div class="space-y-3 md:col-span-2">
          <label class="text-sm text-gray-300">Description</label>
          <textarea id="fDescription" rows="8"
            class="w-full p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none"></textarea>
        </div>
      </div>
    </div>

  </div>

  <!-- Variants -->
  <div class="bg-black/50 border border-white/10 rounded-2xl p-6">
    <div class="flex justify-between mb-4">
      <h2 class="text-xl font-semibold">Variants</h2>
      <button onclick="openVariantModal()" class="px-4 py-2 bg-white/5 border border-white/10 rounded-lg">+ Add
        Variant</button>
    </div>

    <!-- Variant Cards - Mobile -->
    <div class="md:hidden space-y-4" id="variantCards"></div>

    <!-- Variant Table - Desktop -->
    <div class="hidden md:block overflow-x-auto">
      <table class="min-w-full text-left text-sm">
        <thead class="bg-white/5 text-xs uppercase tracking-wide text-gray-400">
          <tr>
            <th class="px-4 py-3">Color</th>
            <th class="px-4 py-3">Size</th>
            <th class="px-4 py-3">Stock</th>
            <th class="px-4 py-3">Price</th>
            <th class="px-4 py-3">Actions</th>
          </tr>
        </thead>
        <tbody id="variantsTable" class="divide-y divide-white/5">
          <td colspan="5" class="px-4 py-6 text-center text-gray-400">Loading variants...</td>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Product Images -->
  <div class="bg-black/50 border border-white/10 rounded-2xl p-6">
    <div class="flex justify-between mb-4">
      <h2 class="text-xl font-semibold">Product Images</h2>

      <button onclick="openImageModal()"
        class="px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 text-sm font-semibold">
        + Add Image
      </button>
    </div>

    <h3 class="text-sm text-gray-400 mb-2">Gallery</h3>
    <div id="galleryGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4 mb-6 overflow-hidden">
    </div>


    <h3 class="text-sm text-gray-400 mb-2">Primary Images</h3>
    <div id="primaryImages"
      class="h-auto w-fit p-4 border border-dashed border-white/10 rounded-xl flex items-center justify-center mb-6"></div>

    <h3 class="text-sm text-gray-400 mb-2">Thumbnail</h3>
    <div id="thumbnailImage"
      class="h-auto w-fit p-4 border border-dashed border-white/10 rounded-xl flex items-center justify-center"></div>
  </div>

  <!-- Danger Zone -->
  <div class="bg-red-600/5 border border-red-500/20 rounded-2xl p-6">
    <h3 class="text-red-400 font-semibold mb-2">Danger Zone</h3>
    <p class="text-gray-400 text-sm mb-4">
      Deleting a product is permanent and cannot be undone.
    </p>
    <button id="deleteBtn"
      class="px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 border border-red-500/30 rounded-lg">
      Delete Product
    </button>
  </div>


</div>

<!-- Variant Modal -->
<div id="variantModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div
    class="bg-black/90 border border-white/10 p-6 rounded-2xl w-full max-w-md shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-4">
      <h3 id="variantModalTitle" class="text-xl font-bold">Add Variant</h3>
      <button onclick="closeVariantModal()" class="text-gray-400 hover:text-white transition">✕</button>
    </div>
    <form id="variantForm" class="space-y-4">
      <div>
        <label class="text-sm text-gray-300">Color</label>
        <input id="vColor" required
          class="w-full mt-1 p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
      </div>
      <div>
        <label class="text-sm text-gray-300">Size</label>
        <input id="vSize" placeholder="Single size (optional)"
          class="w-full mt-1 p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
      </div>

      <div class="mt-2">
        <label class="text-sm text-gray-300">Bulk Sizes</label>
        <div class="grid grid-cols-4 gap-2 mt-2 text-sm">
          {% for s in ["XS","S","M","L","XL","XXL"] %}
          <label class="flex items-center gap-2 bg-black/40 p-2 rounded-lg border border-white/10 cursor-pointer">
            <input type="checkbox" class="bulk-size" value="{{ s }}">
            {{ s }}
          </label>
          {% endfor %}
        </div>
        <p class="text-xs text-gray-400 mt-2">
          If selected, variants will be created for all checked sizes.
        </p>
      </div>

      <div>
        <label class="text-sm text-gray-300">Stock</label>
        <input id="vStock" type="number" min="0" required
          class="w-full mt-1 p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none">
      </div>
      <div>
        <label class="text-sm text-gray-300">Price Override (₹)</label>
        <input id="vPrice" type="number" step="0.01" min="0"
          class="w-full mt-1 p-3 rounded-xl bg-black/60 border border-white/10 focus:border-purple-500 outline-none"
          placeholder="Leave blank to use base price">
      </div>
      <div class="flex gap-3 pt-2">
        <button type="submit"
          class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white py-3 rounded-xl font-semibold transition shadow-lg shadow-purple-500/20">Save
          Variant</button>
        <button type="button" onclick="closeVariantModal()"
          class="px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl font-semibold transition">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!--Add-Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-black/90 border border-white/10 p-6 rounded-2xl w-full max-w-md shadow-2xl max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-4">
      <h3 id="imageModalTitle" class="text-xl font-bold">Add Image</h3>
      <button onclick="closeImageModal()" class="text-gray-400 hover:text-white transition">✕</button>
    </div>
    <form id="imageForm" class="space-y-4">
      <div>
        <label class="text-sm text-gray-300">Color</label>
        <select id="iColor" required class="w-full p-3 rounded-xl bg-black/60 border border-white/10">
        </select>

      </div>
      <div>
        <label class="text-sm text-gray-300">Upload Images</label>
        <input id="imageFiles" type="file" multiple accept="image/*"
          class="w-full mt-1 p-2 rounded-xl bg-black/60 border border-white/10 text-gray-300" />
      </div>

      <div id="imagePreviewGrid" class="grid grid-cols-3 gap-3 mt-4"></div>

      <p class="text-xs text-gray-400 mt-2">
        Select <span class="text-purple-300">Primary (for this color)</span> and
        <span class="text-blue-300">Thumbnail (for entire product)</span>.
      </p>

      <div class="flex gap-3 pt-2">
        <button type="submit"
          class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white py-3 rounded-xl font-semibold transition shadow-lg shadow-purple-500/20">Save
          Image</button>
        <button type="button" onclick="closeImageModal()"
          class="px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl font-semibold transition">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
  const productId = JSON.parse('{{ product_id }}');
  let product = null;
  let variants = [];
  let editingVariantId = null;
  let editingImageId = null;

  let uploadedImages = [];
  let primaryIndex = null;
  let thumbnailIndex = null;



  function authHeaders() {
    const token = localStorage.getItem("admin_token");
    if (!token) {
      window.location.href = "/admin/login";
      return null;
    }
    return { "Authorization": "Bearer " + token, "Content-Type": "application/json" };
  }

  function goBack() { window.location.href = "/admin/api/products"; }

  function setPreview() {
    document.getElementById("productName").textContent = product?.name || "";
    document.getElementById("productCategory").textContent = product?.category || "";
    document.getElementById("previewName").textContent = product?.name || "";
    document.getElementById("previewPrice").textContent = product?.price ? `₹${product.price}` : "";
    document.getElementById("fName").value = product?.name || "";
    document.getElementById("fCategory").value = product?.category || "";
    document.getElementById("fPrice").value = product?.price || 0;
    document.getElementById("fDescription").value = product?.description || "";
  }

  function renderVariants(variants) {
    const tbody = document.getElementById("variantsTable");
    const cards = document.getElementById("variantCards");

    // ---------- Desktop ----------
    if (!variants.length) {
      tbody.innerHTML = `
      <tr>
        <td colspan="5" class="px-4 py-6 text-center text-gray-400">
          No variants yet.
        </td>
      </tr>`;
    } else {
      tbody.innerHTML = variants.map(v => `
      <tr class="hover:bg-white/5 transition">
        <td class="px-4 py-3 text-white">${v.color}</td>
        <td class="px-4 py-3 text-white">${v.size || "—"}</td>
        <td class="px-4 py-3 text-gray-200">${v.stock}</td>
        <td class="px-4 py-3 text-purple-300">
          ${v.price_override ? "₹" + v.price_override : "—"}
        </td>
        <td class="px-4 py-3 flex gap-2">
          <button onclick="editVariant(${v.id})"
            class="px-3 py-2 bg-blue-600/20 border border-blue-500/30 text-blue-300 rounded-lg text-sm">
            Edit
          </button>
          <button onclick="deleteVariant(${v.id})"
            class="px-3 py-2 bg-red-600/20 border border-red-500/30 text-red-300 rounded-lg text-sm">
            Delete
          </button>
        </td>
      </tr>
    `).join("");
    }

    // ---------- Mobile ----------
    if (!variants.length) {
      cards.innerHTML = `<p class="text-gray-400 text-center">No variants yet.</p>`;
      return;
    }

    cards.innerHTML = variants.map(v => `
    <div class="bg-black/40 border border-white/10 rounded-xl p-4 flex flex-col gap-2">
      <div class="flex justify-between items-center">
        <p class="font-semibold text-white">${v.color}</p>
        <span class="text-xs text-gray-400">${v.size || "Free size"}</span>
      </div>

      <div class="flex justify-between text-sm">
        <span class="text-gray-400">Stock</span>
        <span class="text-gray-200">${v.stock}</span>
      </div>

      <div class="flex justify-between text-sm">
        <span class="text-gray-400">Price</span>
        <span class="text-purple-300 font-semibold">
          ${v.price_override ? "₹" + v.price_override : "Base"}
        </span>
      </div>

      <div class="flex gap-2 mt-3">
        <button onclick="editVariant(${v.id})"
          class="flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500/30 text-blue-300 rounded-lg text-sm">
          Edit
        </button>
        <button onclick="deleteVariant(${v.id})"
          class="flex-1 px-3 py-2 bg-red-600/20 border border-red-500/30 text-red-300 rounded-lg text-sm">
          Delete
        </button>
      </div>
    </div>
  `).join("");
  }


  function renderImages(images) {
    // PRODUCT-LEVEL THUMBNAIL (one)
    const thumbnail = images.find(i => i.role === "thumbnail");

    // COLOR-LEVEL PRIMARIES (many)
    const primariesByColor = {};
    images
      .filter(i => i.role === "primary")
      .forEach(img => {
        primariesByColor[img.color] = img;
      });

    // GALLERY
    const gallery = images.filter(i => i.role === "gallery");

    // Right-side preview image
    document.getElementById("productImage").src =
      thumbnail
        ? thumbnail.image_url
        : Object.values(primariesByColor)[0]?.image_url
        || '/static/img/placeholder.webp';

    // PRIMARY IMAGES (MULTIPLE)
    const primaryContainer = document.getElementById("primaryImages");

    if (Object.keys(primariesByColor).length) {
      primaryContainer.innerHTML = Object.entries(primariesByColor)
        .map(([color, img]) => `
        <div class="flex flex-col gap-1">
          <p class="text-xs text-gray-400">${color}</p>
          ${imageCard(img)}
        </div>
      `)
        .join("");
    } else {
      primaryContainer.innerHTML = emptySlot("No primary images set");
    }

    // THUMBNAIL
    document.getElementById("thumbnailImage").innerHTML =
      thumbnail
        ? imageCard(thumbnail)
        : emptySlot("Thumbnail not set");

    // GALLERY
    document.getElementById("galleryGrid").innerHTML =
      gallery.length
        ? gallery.map(imageCard).join("")
        : `<p class="text-gray-500 col-span-full">No gallery images</p>`;
  }


  document.getElementById("imageFiles").addEventListener("change", (e) => {
    const files = Array.from(e.target.files);
    uploadedImages = files;
    primaryIndex = null;
    thumbnailIndex = null;
    renderImagePreviews();
  });

  function renderImagePreviews() {
    const grid = document.getElementById("imagePreviewGrid");
    grid.innerHTML = "";

    uploadedImages.forEach((file, index) => {
      const url = URL.createObjectURL(file);

      grid.innerHTML += `
      <div
        class="relative cursor-pointer border rounded-xl overflow-hidden group"
        onclick="toggleImageRole(${index})"
      >
        <img src="${url}" class="w-full h-24 object-cover">
        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center text-xs gap-1">
          <span class="text-purple-300">${primaryIndex === index ? "Primary" : ""}</span>
          <span class="text-blue-300">${thumbnailIndex === index ? "Thumbnail" : ""}</span>
          <span class="text-gray-300">${(![primaryIndex, thumbnailIndex].includes(index)) ? "Gallery" : ""}</span>
        </div>
      </div>
    `;
    });
  }

  function imageCard(img) {
    return `
  <div class="relative group">
    <img src="${img.image_url}" class="w-full h-40 md:h-80 aspect-square object-cover rounded-xl border border-white/10"/>

    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-2">
      <button data-id="${img.id}" onclick='openImageModal(${JSON.stringify(img)})'
 class="px-3 py-2 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 text-blue-300 rounded-lg text-sm">
        Edit
      </button>
      <button onclick="deleteImage(${img.id})"
        class="px-3 py-2 bg-red-600/20 hover:bg-red-600/30 border border-red-500/30 text-red-300 rounded-lg text-sm">
        Delete
      </button>
    </div>
  </div>`;
  }

  function toggleImageRole(index) {
    if (primaryIndex === null) {
      primaryIndex = index;
    }
    else if (thumbnailIndex === null && index !== primaryIndex) {
      if (productHasThumbnail()) {
        if (!confirm("This will replace the existing product thumbnail. Continue?")) {
          return;
        }
      }
      thumbnailIndex = index;
    }
    else {
      primaryIndex = index;
      thumbnailIndex = null;
    }

    renderImagePreviews();
  }



  function emptySlot(text) {
    return `<p class="text-gray-500">${text}</p>`;
  }

  async function loadProduct() {
    const headers = authHeaders();
    if (!headers) return;
    const res = await fetch(`/admin/api/products/${productId}`, { headers });

    if (!res.ok) {
      if (res.status === 401 || res.status === 403) {
        localStorage.removeItem("admin_token");
        return window.location.href = "/admin/login";
      }
      document.body.innerHTML = "<div class='p-8 text-red-400'>Failed to load product.</div>";
      return;
    }

    const data = await res.json();
    product = data;
    variants = data.variants || [];
    renderVariants(data.variants || []);
    populateImageColorDropdown();
    renderImages(data.images || []);
    setPreview();

  }

  document.getElementById("saveBtn").addEventListener("click", async () => {
    const headers = authHeaders();
    if (!headers) return;
    const body = {
      name: document.getElementById("fName").value,
      category: document.getElementById("fCategory").value,
      price: parseFloat(document.getElementById("fPrice").value || 0),
      description: document.getElementById("fDescription").value
    };
    const res = await fetch(`/admin/api/products/${productId}`, {
      method: "PUT",
      headers,
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) {
      alert(data.error || "Failed to update product");
      return;
    }
    await loadProduct();
    populateImageColorDropdown();

    alert("Product updated");
  });

  document.getElementById("deleteBtn").addEventListener("click", async () => {
    const headers = authHeaders();
    if (!headers) return;
    if (!confirm("Delete this product?")) return;
    const res = await fetch(`/admin/api/products/${productId}`, { method: "DELETE", headers });
    const data = await res.json();
    if (!res.ok) {
      alert(data.error || "Failed to delete product");
      return;
    }
    window.location.href = "/admin/api/products";
  });

  function openVariantModal() {
    editingVariantId = null;
    document.getElementById("variantModalTitle").textContent = "Add Variant";
    document.getElementById("variantForm").reset();
    document.getElementById("variantModal").classList.remove("hidden");
  }
  function closeVariantModal() { document.getElementById("variantModal").classList.add("hidden"); }

  function openImageModal(image = null) {
    if (!variants.length) {
      alert("Add at least one variant before adding images.");
      return;
    }

    editingImageId = image ? image.id : null;

    document.getElementById("imageModalTitle").textContent =
      editingImageId ? "Edit Image" : "Add Image";

    document.getElementById("imageForm").reset();

    if (image) {
      document.getElementById("iColor").value = image.color;
      document.getElementById("image").value = image.image_url;
      document.getElementById("sortOrder").value = image.sort_order || 0;
    }

    document.getElementById("imageModal").classList.remove("hidden");
  }

  function closeImageModal() { document.getElementById("imageModal").classList.add("hidden"); }

  function editVariant(id) {
    const v = variants.find(x => x.id === id);
    if (!v) return;
    editingVariantId = id;
    document.getElementById("variantModalTitle").textContent = "Edit Variant";
    document.getElementById("vColor").value = v.color || "";
    document.getElementById("vSize").value = v.size || "";
    document.getElementById("vStock").value = v.stock || 0;
    document.getElementById("vPrice").value = v.price_override ?? "";
    document.getElementById("variantModal").classList.remove("hidden");
  }

  document.getElementById("variantForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const headers = authHeaders();
    if (!headers) return;
    const selectedSizes = [...document.querySelectorAll(".bulk-size:checked")]
      .map(cb => cb.value);

    const body = {
      color: document.getElementById("vColor").value,
      size: document.getElementById("vSize").value || null,
      sizes: selectedSizes.length ? selectedSizes : null,
      stock: parseInt(document.getElementById("vStock").value || 0, 10),
      price_override: document.getElementById("vPrice").value
        ? parseFloat(document.getElementById("vPrice").value)
        : null
    };

    const res = await fetch(editingVariantId ? `/admin/api/variants/${editingVariantId}` : `/admin/api/products/${productId}/variants`, {
      method: editingVariantId ? "PUT" : "POST",
      headers,
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) {
      alert(data.error || "Failed to save variant");
      return;
    }
    closeVariantModal();
    await loadProduct();
    populateImageColorDropdown();

  });

  function populateImageColorDropdown() {
    const dropdown = document.getElementById("iColor");
    if (!dropdown) return;

    // Extract unique colors from variants
    const colors = [...new Set(variants.map(v => v.color))];

    dropdown.innerHTML = "";

    if (!colors.length) {
      dropdown.innerHTML = `<option disabled selected>No colors available</option>`;
      return;
    }

    colors.forEach(color => {
      const opt = document.createElement("option");
      opt.value = color;
      opt.textContent = color;
      dropdown.appendChild(opt);
    });
  }


  async function deleteVariant(id) {
    const headers = authHeaders();
    if (!headers) return;
    if (!confirm("Delete this variant?")) return;
    const res = await fetch(`/admin/api/variants/${id}`, { method: "DELETE", headers });
    const data = await res.json();
    if (!res.ok) {
      alert(data.error || "Failed to delete variant");
      return;
    }
    await loadProduct();
    populateImageColorDropdown();

  }

  document.getElementById("imageForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const headers = authHeaders();
    if (!headers) return;

    if (!uploadedImages.length) {
      alert("Upload at least one image");
      return;
    }

    if (primaryIndex === null) {
      alert("Select a Primary image");
      return;
    }

    const formData = new FormData();
    formData.append("color", document.getElementById("iColor").value);
    formData.append("primary_index", primaryIndex);
    formData.append("thumbnail_index", thumbnailIndex);

    uploadedImages.forEach(file => {
      formData.append("images", file);
    });

    try {
      const res = await fetch(
        `/admin/api/products/${productId}/images/upload`,
        {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + localStorage.getItem("admin_token")
          },
          body: formData
        }
      );

      const data = await res.json();

      if (!res.ok) {
        alert(data.error || "Upload failed");
        return;
      }

      closeImageModal();
      uploadedImages = [];
      primaryIndex = null;
      thumbnailIndex = null;

      await loadProduct();
      populateImageColorDropdown();

      alert("Images uploaded successfully ✅");

    } catch (err) {
      alert("Network error during image upload");
    }
  });

  function productHasThumbnail() {
    return product?.images?.some(img => img.role === "thumbnail");
  }


  function deleteImage(imageId) {
    fetch(`/admin/api/images/${imageId}`, {
      method: "DELETE",
      headers: {
        "Authorization": "Bearer " + localStorage.getItem("admin_token")
      }
    }).then(() => loadProduct());
  }


  document.addEventListener("DOMContentLoaded", loadProduct);
</script>
{% endblock %}